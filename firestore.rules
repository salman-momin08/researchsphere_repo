
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Users collection
    // - Authenticated users can create their own profile document where the document ID
    //   and the 'id' field within the document match their UID.
    // - Authenticated users can read, update, and delete their own profile document.
    match /users/{userId} {
      allow read, update, delete: if request.auth != null && request.auth.uid == userId;
      // Ensure the user is creating their own document and the 'id' field in the document matches their UID.
      allow create: if request.auth != null && request.auth.uid == userId && request.resource.data.id == request.auth.uid;
    }

    // Papers collection
    // - Authenticated users can create paper documents, and the 'userId' field in the paper
    //   document must match their UID.
    // - Users can read, update, and delete only papers where the 'userId' field
    //   matches their UID.
    match /papers/{paperId} {
      allow read, update, delete: if request.auth != null && request.auth.uid == resource.data.userId;
      // Ensure the user is authenticated and is setting their own UID in the 'userId' field.
      allow create: if request.auth != null && request.resource.data.userId == request.auth.uid;
    }
  }
}
